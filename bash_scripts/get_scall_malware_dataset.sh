#!/bin/bash

# Gets selected feature vector for all logs in the directory
# Run as:
#        ./get_scall_malware_dataset.sh "SYSCALL_LIST_FILE" "FEATURE_VECTOR_PARAMS" OUTPUT_FOLDER
#        ./get_scall_malware_dataset.sh all_syscalls.txt "--com 5" com5

PYTHON_FEATURE_VECTOR_PATH="$HOME/PycharmProjects/ids_for_android/get_feature_vector.py"
SYSCALL_LOGS_PATH="$HOME/MEGA/dataset/malware_traces"
OUTPUT_PATH="$HOME/MEGA/dataset/malware_feature_vectors/$3"
#SYSCALL_LIST_PATH="$HOME/MEGA/dataset/all_syscalls.txt"
SYSCALL_LIST_PATH="$HOME/MEGA/dataset/$1"
FEATURE_VECTOR_PARAMS="$2" # e.g. "--com 5"

mkdir -p "$OUTPUT_PATH"

log_files=($(find "$SYSCALL_LOGS_PATH" -maxdepth 1 -type f))

if [ $? -ne 0 ]
then
    printf "%s\n" "Error: Cannot find logs."
    continue
fi

for log_file in "${log_files[@]}"
do
    output_file_path="$OUTPUT_PATH/${log_file##*/}"

    python3.5 "$PYTHON_FEATURE_VECTOR_PATH" "$log_file" --syscalls "$SYSCALL_LIST_PATH" --csv $FEATURE_VECTOR_PARAMS --normalise>"$output_file_path"
    if [ $? -ne 0 ]
    then
        printf "%s\n" "Error: Cannot get feature vector for log $log_file"
        continue
    fi
done
